DROP TABLE organization CASCADE;
DROP TABLE team CASCADE;
DROP TABLE player CASCADE;
DROP TABLE team_roster;
DROP TABLE admin;

CREATE TABLE organization(
	ID uuid DEFAULT uuid_generate_v4(),
	NAME VARCHAR(45) NOT NULL,
	IMAGE VARCHAR(500),
	INFO VARCHAR(1000),
	MAIN_COLOR VARCHAR(20) DEFAULT 'FFFFFF',
	APPROVAL_STATUS VARCHAR(20) NOT NULL DEFAULT 'UNAPPROVED',
	DATE_CREATED timestamp DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY(ID)
);

CREATE TABLE admin(
	AUTH_ID VARCHAR(30),
	FIRST_NAME VARCHAR(45),
	LAST_NAME VARCHAR(45),
	LANGUAGE VARCHAR(45) NOT NULL,
	ROLE VARCHAR(15) NOT NULL DEFAULT 'SLAVE',
	STATUS VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
	DATE_CREATED TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	organization_ID uuid NOT NULL,
	PRIMARY KEY(AUTH_ID),
	CONSTRAINT fk_organization 
		FOREIGN KEY(organization_id) 
		REFERENCES organization(id) 
		ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS team(
	ID SERIAL NOT NULL,
	NAME VARCHAR(45) NOT NULL,
	WINS SMALLINT DEFAULT 0,
	TIES SMALLINT NOT NULL DEFAULT 0,
	LOSSES SMALLINT NOT NULL DEFAULT 0,
	IMAGE VARCHAR(500),
	VISIBILITY VARCHAR(20) NOT NULL DEFAULT 'PRIVATE',
	SPORT VARCHAR(20) NOT NULL,
	SPORTSMANSHIP_SCORE DECIMAL NOT NULL DEFAULT 4.0,
	STATUS VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
	MAX_TEAM_SIZE SMALLINT,
	WOMEN_COUNT SMALLINT NOT NULL DEFAULT 0,
	MEN_COUNT SMALLINT NOT NULL DEFAULT 0,
	DATE_CREATED TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	organization_ID uuid NOT NULL,
	PRIMARY KEY(ID),
	CONSTRAINT fk_organization 
		FOREIGN KEY(organization_id) 
		REFERENCES organization(id) 
		ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS player (
	AUTH_ID VARCHAR(30) NOT NULL,
	FIRST_NAME VARCHAR(45),
	LAST_NAME VARCHAR(45),
	LANGUAGE VARCHAR(45) NOT NULL DEFAULT 'ENGLISH',
	STATUS VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
	DATE_CREATED TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	GENDER VARCHAR(10),
	EMAIL_ADDRESS VARCHAR(80),
	DOB DATE,
	VISIBILITY VARCHAR(15) NOT NULL DEFAULT 'PRIVATE',
	GRADUATION_TERM VARCHAR(30),
	IMAGE VARCHAR(500),
	organization_ID uuid NOT NULL, 
	PRIMARY KEY(AUTH_ID),
	CONSTRAINT fk_organization 
		FOREIGN KEY(organization_id) 
		REFERENCES organization(id) 
		ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS team_roster(
	player_AUTH_ID VARCHAR(30) NOT NULL,  
	team_ID INTEGER NOT NULL,
	ROLE VARCHAR(20) NOT NULL DEFAULT 'PLAYER',
	PRIMARY KEY (player_AUTH_ID, team_ID),
	CONSTRAINT fk_player_on_team
		FOREIGN KEY(player_AUTH_ID)
		REFERENCES player(AUTH_ID)
		ON DELETE CASCADE
		ON UPDATE NO ACTION,
	CONSTRAINT fk_team_team
		FOREIGN KEY(team_ID)
		REFERENCES team(ID)
		ON DELETE CASCADE
		ON UPDATE NO ACTION
);

with new_organization as (
	INSERT INTO organization (NAME, IMAGE, INFO, MAIN_COLOR) 
	VALUES 
		('Grand Canyon University', null, 'All the info', 'Purple') RETURNING id
),
new_team AS (
	INSERT INTO team (ID, NAME, IMAGE, SPORT, MAX_TEAM_SIZE, organization_id) 
	VALUES 
		(4, 'Team Anderson', null, 'Soccer', 12, (SELECT id FROM new_organization)),
		(10, 'F1', null, 'Soccer', 12, (SELECT id FROM new_organization)),
		(12, 'Affordable Christians', null, 'Soccer', 12, (SELECT id FROM new_organization))
),
new_admin AS(
	INSERT INTO admin(AUTH_ID, FIRST_NAME, LAST_NAME, LANGUAGE, ROLE, organization_id) 
	VALUES 
		('test1', 'Noah', 'Roerig', 'ENGLISH', 'MASTER', (SELECT id FROM new_organization)),
		('test2', 'Stevan', 'Perrino', 'ENGLISH', 'WORKER', (SELECT id FROM new_organization))
),
new_player AS(
	INSERT INTO player(AUTH_ID, FIRST_NAME, LAST_NAME, GENDER, EMAIL_ADDRESS, DOB, GRADUATION_TERM, IMAGE, organization_ID)
	VALUES
		('player1', 'Noah', 'Roerig', 'MALE', 'noahr1936@gmail.com', '2001-02-21', '2023_1', null, (SELECT id FROM new_organization)),
		('player2', 'Stevan', 'Perrino', 'MALE', 'stevanp1936@gmail.com', '2001-02-21', '2024_1', null, (SELECT id FROM new_organization)),
		('player3', 'Jacob', 'Hropoff', 'MALE', 'jacobh1936@gmail.com', '2001-02-21', '2024_1', null, (SELECT id FROM new_organization)),
		('player4', 'Jimmy', 'Canon', 'MALE', 'jimmyc1936@gmail.com', '2001-02-21', '2024_1', null, (SELECT id FROM new_organization))
)
INSERT INTO team_roster (player_AUTH_ID, team_ID, ROLE)
VALUES
	('player1', 12, 'CAPTAIN'),
	('player2', 12, 'PLAYER'),
	('player3', 10, 'PLAYER'),
	('player4', 10, 'PLAYER');

DELETE FROM admin;
DELETE FROM player;
DELETE FROM organization;
DELETE FROM team;
DELETE FROM team_roster;